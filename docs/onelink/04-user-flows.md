# OneLink ì‚¬ìš©ìž í”Œë¡œìš° & ìƒíƒœ ë¨¸ì‹ 

## 1. ë§ˆë²•ì‚¬ (Wizard) í”Œë¡œìš°

### 1.1 ë©”ì¸ ì‹œë‚˜ë¦¬ì˜¤: ë¡œê·¸ì¸ + GitHub ì—°ê²°ëœ ì‚¬ìš©ìž

```
[/oneclick ì§„ìž…]
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 0: í…œí”Œë¦¿ ì„ íƒ  â”‚
â”‚  - ì¹´ë“œ ëª©ë¡ì—ì„œ ì„ íƒ  â”‚
â”‚  - ì‚¬ì´íŠ¸ëª… ìž…ë ¥       â”‚
â”‚  - "ë°°í¬" ë²„íŠ¼ í´ë¦­    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ handleDeploy() â†’ isAuthenticated âœ“ + isGitHubConnected âœ“
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  executeDeploy()     â”‚
â”‚  POST /deploy-pages  â”‚
â”‚  â†’ deploy_id ìˆ˜ì‹     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ setCurrentStep(2)
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: ë°°í¬ ì§„í–‰    â”‚
â”‚  - 3ë‹¨ê³„ í”„ë¡œê·¸ë ˆìŠ¤    â”‚
â”‚    1. ë ˆí¬ ìƒì„± âœ“     â”‚
â”‚    2. Pages í™œì„±í™” â³  â”‚
â”‚    3. ì‚¬ì´íŠ¸ ê²Œì‹œ â³   â”‚
â”‚  - 3ì´ˆ í´ë§           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ deploy_status === 'ready'
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ë°°í¬ ì™„ë£Œ!           â”‚
â”‚  - ì‚¬ì´íŠ¸ URL í‘œì‹œ    â”‚
â”‚  - "ì‚¬ì´íŠ¸ ë³´ê¸°" ë§í¬  â”‚
â”‚  - "íŽ¸ì§‘í•˜ê¸°" ë§í¬     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ì‹œë‚˜ë¦¬ì˜¤: ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ìž

```
[Step 0: í…œí”Œë¦¿ ì„ íƒ & ë°°í¬ í´ë¦­]
           â”‚
           â”‚ handleDeploy() â†’ isAuthenticated âœ—
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  sessionStorageì— pending ì €ìž¥   â”‚
â”‚  { templateId, siteName }       â”‚
â”‚  redirect â†’ /login?redirect=... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ ë¡œê·¸ì¸ ì™„ë£Œ
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  /oneclickìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸         â”‚
â”‚  â†’ GitHub ì—°ê²° ì—¬ë¶€ í™•ì¸          â”‚
â”‚  â†’ ë¯¸ì—°ê²°ì´ë©´ Step 1ë¡œ           â”‚
â”‚  â†’ ì—°ê²°ì´ë©´ executeDeploy()      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 ì‹œë‚˜ë¦¬ì˜¤: ë¡œê·¸ì¸ + GitHub ë¯¸ì—°ê²°

```
[Step 0: í…œí”Œë¦¿ ì„ íƒ & ë°°í¬ í´ë¦­]
           â”‚
           â”‚ handleDeploy() â†’ isAuthenticated âœ“, isGitHubConnected âœ—
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: GitHub ì—°ê²°             â”‚
â”‚  - setPendingDeploy(data)       â”‚
â”‚  - "GitHub ì—°ê²°" ë²„íŠ¼ í‘œì‹œ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ ë²„íŠ¼ í´ë¦­
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GET /api/oneclick/oauth/authorize â”‚
â”‚  â†’ GitHub OAuth íŽ˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ OAuth ì™„ë£Œ
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  /oneclick?oauth_success=github â”‚
â”‚  - sessionStorageì—ì„œ ë³µì›       â”‚
â”‚  - handleGitHubConnected()      â”‚
â”‚  - pendingDeploy ìžˆìœ¼ë©´ ìžë™ë°°í¬  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ìƒíƒœ ë¨¸ì‹ 

### 2.1 Wizard Step ìƒíƒœ

```
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  Step 0: Template â”‚ â—„â”€â”€â”€ handleRetry()
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚          â”‚          â”‚
        ë¹„ë¡œê·¸ì¸     GitHubë¯¸ì—°ê²°    ì—°ê²°ë¨
              â”‚          â”‚          â”‚
              â–¼          â–¼          â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  executeDeploy()
         â”‚ Login   â”‚ â”‚ Step 1 â”‚    â”‚
         â”‚ Redirectâ”‚ â”‚ GitHub â”‚    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â”‚
                         â”‚         â”‚
                    OAuth ì™„ë£Œ      â”‚
                         â”‚         â”‚
                         â–¼         â”‚
                   handleGithub    â”‚
                   Connected()     â”‚
                         â”‚         â”‚
                         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Step 2: Deploy  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚        â”‚        â”‚
                  ready    error   timeout
                    â”‚        â”‚        â”‚
                    â–¼        â–¼        â”‚
                 [ì™„ë£Œ]  [ìž¬ì‹œë„]     [ìž¬ì‹œë„]
```

### 2.2 ë°°í¬ ìƒíƒœ (deploy_status)

```
pending â”€â”€â–º creating â”€â”€â–º building â”€â”€â–º ready
                â”‚             â”‚
                â–¼             â–¼
             error          error
                              â”‚
                              â–¼
                           timeout (í´ë¼ì´ì–¸íŠ¸ ì „ìš©)
```

### 2.3 Pages ìƒíƒœ (pages_status)

```
pending â”€â”€â–º enabling â”€â”€â–º building â”€â”€â–º built
                             â”‚
                             â–¼
                          errored
```

### 2.4 Fork ìƒíƒœ (fork_status)

```
pending â”€â”€â–º forking â”€â”€â–º forked
                â”‚
                â–¼
             failed
```

> **ì°¸ê³ **: GitHub Pages ë°°í¬ì—ì„œëŠ” `fork_status`ê°€ í•­ìƒ ë°”ë¡œ `forked`ë¡œ ì„¤ì •ë¨ (ì‹¤ì œ forkê°€ ì•„ë‹Œ ìƒˆ ë ˆí¬ ìƒì„±ì´ë¯€ë¡œ)

---

## 3. í´ë§ ë¡œì§ ìƒì„¸

### í´ë¼ì´ì–¸íŠ¸ (TanStack Query)
```typescript
refetchInterval: (query) => {
  const data = query.state.data;

  // í„°ë¯¸ë„ ìƒíƒœ â†’ í´ë§ ì¤‘ì§€
  if (['ready', 'error', 'canceled', 'timeout'].includes(data.deploy_status)) {
    if (data.deploy_status === 'ready') {
      // í”„ë¡œì íŠ¸ ëª©ë¡ ìºì‹œ ë¬´íš¨í™”
      queryClient.invalidateQueries({ queryKey: queryKeys.projects.all });
    }
    return false; // í´ë§ ì¤‘ì§€
  }

  // ìµœëŒ€ 100íšŒ (â‰ˆ5ë¶„) í›„ íƒ€ìž„ì•„ì›ƒ
  if (query.state.dataUpdateCount >= 100) {
    queryClient.setQueryData(..., { ...prev, deploy_status: 'timeout' });
    return false;
  }

  return 3000; // 3ì´ˆ ê°„ê²©
}
```

### ì„œë²„ (status route)
```
1. DBì—ì„œ deploy ë ˆì½”ë“œ ì¡°íšŒ
2. deploy_statusê°€ 'ready'/'error'ê°€ ì•„ë‹ˆë©´:
   a. GitHub service_account ì¡°íšŒ â†’ í† í° ë³µí˜¸í™”
   b. GitHub Pages API í˜¸ì¶œ
   c. ìƒíƒœ ë§¤í•‘ & DB ì—…ë°ì´íŠ¸
3. buildSteps()ë¡œ UI ìŠ¤í… ê³„ì‚°
4. ì‘ë‹µ ë°˜í™˜
```

---

## 4. My Sites í”Œë¡œìš°

### 4.1 ëŒ€ì‹œë³´ë“œ
```
[/my-sites]
    â”‚
    â”œâ”€ GET /api/oneclick/deployments
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì‚¬ì´íŠ¸ ì¹´ë“œ ê·¸ë¦¬ë“œ          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚Site1â”‚ â”‚Site2â”‚ â”‚Site3â”‚  â”‚
â”‚  â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜  â”‚
â”‚     â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚
      â”œâ”€ "ì‚¬ì´íŠ¸ ë³´ê¸°" â†’ pages_url ì™¸ë¶€ ë§í¬
      â”œâ”€ "íŽ¸ì§‘í•˜ê¸°" â†’ /my-sites/{id}/edit
      â””â”€ "ì‚­ì œ" â†’ DELETE /deployments/{id}
```

### 4.2 ì‚¬ì´íŠ¸ íŽ¸ì§‘ê¸°
```
[/my-sites/{id}/edit]
    â”‚
    â”œâ”€ GET /deployments/{id}/files (íŒŒì¼ ëª©ë¡)
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ íŒŒì¼    â”‚  ì½”ë“œ ì—ë””í„°  â”‚ ë¯¸ë¦¬ë³´ê¸°â”‚  â”‚
â”‚  â”‚ ëª©ë¡    â”‚              â”‚ (HTML) â”‚  â”‚
â”‚  â”‚        â”‚              â”‚        â”‚  â”‚
â”‚  â”‚        â”‚              â”‚        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  AI ì±„íŒ… í„°ë¯¸ë„                    â”‚ â”‚
â”‚  â”‚  "ë°°ê²½ìƒ‰ì„ íŒŒëž€ìƒ‰ìœ¼ë¡œ ë°”ê¿”ì¤˜"      â”‚ â”‚
â”‚  â”‚  â†’ AI ì‘ë‹µ â†’ [ì ìš©] ë²„íŠ¼          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**íŽ¸ì§‘ í”Œë¡œìš°**:
1. íŒŒì¼ ì„ íƒ â†’ `GET /files?path=style.css` â†’ ì—ë””í„°ì— ë¡œë“œ
2. ì½”ë“œ ìˆ˜ì • â†’ "ì €ìž¥" â†’ `PUT /files` â†’ GitHub ì»¤ë°‹
3. ë¯¸ë¦¬ë³´ê¸° ìžë™ ê°±ì‹  (iframe srcdoc)

**AI ì±„íŒ… í”Œë¡œìš°**:
1. ë©”ì‹œì§€ ìž…ë ¥ â†’ `POST /ai-chat`
2. AI ì‘ë‹µì—ì„œ ì½”ë“œ ë¸”ë¡ íŒŒì‹± (`ðŸ“„ filename.ext`)
3. "ì ìš©" â†’ `useBatchApplyFiles` â†’ ìˆœì°¨ì  `PUT /files`
4. íŒŒì¼ ìºì‹œ ë¬´íš¨í™” â†’ ë¯¸ë¦¬ë³´ê¸° ê°±ì‹ 

---

## 5. OAuth ìƒíƒœ ë³´ì¡´

### ë¬¸ì œ
GitHub OAuth ë¦¬ë‹¤ì´ë ‰íŠ¸ ì¤‘ì— ì‚¬ìš©ìžì˜ ì„ íƒ (í…œí”Œë¦¿, ì‚¬ì´íŠ¸ëª…)ì„ ë³´ì¡´í•´ì•¼ í•¨

### í•´ê²°
```
[ë°°í¬ ì‹œìž‘]
    â”‚ sessionStorage.setItem('linkmap-pending-deploy', JSON.stringify({templateId, siteName}))
    â–¼
[GitHub OAuth ë¦¬ë‹¤ì´ë ‰íŠ¸]
    â”‚
    â–¼
[/oneclick?oauth_success=github]
    â”‚ const saved = sessionStorage.getItem('linkmap-pending-deploy')
    â”‚ sessionStorage.removeItem(...)
    â–¼
[ìžë™ ë°°í¬ ì‹¤í–‰]
```

> **ì´ìŠˆ**: `sessionStorage`ëŠ” ê°™ì€ íƒ­ì—ì„œë§Œ ìœ íš¨. ìƒˆ íƒ­ì—ì„œ OAuth ì½œë°±ì´ ì˜¤ë©´ ë°ì´í„° ì†Œì‹¤.
> Zustand `persist` (localStorage)ì™€ `sessionStorage`ê°€ í˜¼ìž¬.
